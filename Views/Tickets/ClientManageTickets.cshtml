@model IEnumerable<Cinema.Models.DataBaseModels.Ticket>

@{
    ViewData["Title"] = "Select Seats";
}

<h2>Select Seats</h2>

<div class="hall-layout">
    @foreach (var row in Model.GroupBy(t => t.Seat.RowId).OrderBy(g => g.Key))
    {
        <div class="row-layout">
            @foreach (var ticket in row.OrderBy(t => t.Seat.SeatNumber))
            {
                <div class="seat @(ticket.Seat.SeatType.ToLower()) @(ticket.IsBooked ? "booked" : "") @(ticket.IsSelected ? "selected" : "")"
                     data-ticket-id="@ticket.Id"
                     data-seat-number="@ticket.Seat.SeatNumber"
                     data-seat-type="@ticket.Seat.SeatType"
                     data-price="@ticket.Price">
                    <span>@ticket.Seat.SeatNumber</span>
                    <span class="ticket-price">@ticket.Price$</span>
                </div>

                @* Add gap between VIP seats *@
                @if (ticket.Seat.SeatType.ToLower() == "vip")
                {
                    <div class="vip-gap"></div>
                }
            }
        </div>
    }
</div>


<div class="screen-container">
    <div class="screen">Екран</div>
</div>


<!-- Кнопка для підтвердження вибору -->
<button id="confirm-selection-btn">Confirm Selection</button>

<div class="total-price">
    Total Price: <span id="totalPrice">0</span>$
</div>

<style>
    .hall-layout {
        display: flex;
        flex-direction: column;
        gap: 10px; /* Збільшено відстань між рядами */
        align-items: center;
        margin-bottom: 30px;
    }

    .row-layout {
        display: flex;
        gap: 10px; /* Збільшено проміжок між місцями */
        align-items: center;
    }

    .seat {
        width: 50px;  /* Збільшено ширину */
        height: 50px; /* Збільшено висоту */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid black;
        font-size: 16px; /* Збільшено шрифт */
        padding: 5px;
    }

    .ticket-price {
        font-size: 14px;
        font-weight: bold;
        color: green;
        margin-top: 5px;
    }

    .booked {
        background-color: red !important;
        cursor: not-allowed;
    }

    .standard { background-color: lightgray; }
    .vip { background-color: gold; }
    .disabled { background-color: blue; }
    .selected { background-color: lightgreen; }

    .vip-gap {
        width: 30px; /* Більший відступ */
    }

    .screen-container {
        display: flex;
        justify-content: center;
        width: 100%;
    }

    .screen {
        width: 50%;
        height: 40px; /* Збільшено висоту */
        background-color: black;
        color: white;
        text-align: center;
        font-size: 20px; /* Збільшено шрифт */
        font-weight: bold;
        margin-top: 30px;
        border-radius: 8px;
        line-height: 40px; /* Вирівняно текст по вертикалі */
    }
</style>

<script>
    document.querySelectorAll(".seat:not(.booked)").forEach(seat => {
        seat.addEventListener("click", function () {
            const seatPrice = parseFloat(this.getAttribute("data-price"));

            if (this.classList.contains("selected")) {
                this.classList.remove("selected");
                updateTotalPrice(-seatPrice);
            } else {
                this.classList.add("selected");
                updateTotalPrice(seatPrice);
            }
        });
    });

    function updateTotalPrice(priceChange) {
        let totalPrice = parseFloat(document.getElementById("totalPrice").innerText);
        totalPrice += priceChange;
        document.getElementById("totalPrice").innerText = totalPrice.toFixed(2);
    }

    document.getElementById("confirm-selection-btn").addEventListener("click", async () => {
        const selectedSeats = [];
        document.querySelectorAll(".seat.selected").forEach(seat => {
            selectedSeats.push({
                ticketId: seat.getAttribute("data-ticket-id"),
            });
        });

        if (selectedSeats.length === 0) {
            alert("Please select at least one seat.");
            return;
        }

        const response = await fetch('/Tickets/ConfirmSelection', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(selectedSeats)
        });

        const result = await response.json();
        if (result.success) {
            alert("Seats booked successfully!");
            location.reload();
        } else {
            alert("Some seats were already booked. Please select again.");
            location.reload();
        }
    });
</script>
