@{
    ViewData["Title"] = "Payment";
    var totalPrice = ViewData["TotalPrice"];
}

<h2>Payment</h2>
<div>
    Total amount to pay: @totalPrice$
</div>

<!-- Форма для підтвердження оплати -->
<form id="paymentForm">
    <input type="hidden" id="ticketIds" />
    <button type="submit">Confirm Payment</button>
</form>

<script>
        document.getElementById("paymentForm").addEventListener("submit", async (event) => {
        event.preventDefault();

        const ticketIds = [];  // Selected tickets

        document.querySelectorAll(".seat.selected").forEach(seat => {
            ticketIds.push(seat.getAttribute("data-ticket-id"));
        });

        const response = await fetch('/Tickets/ProcessPayment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ TicketIds: ticketIds, Amount: parseFloat(totalPrice) })
        });

        const result = await response.json();
        if (result.success) {
            alert("Payment successful!");
            location.reload();
        } else {
            alert("Payment failed.");
        }
    });

</script>
