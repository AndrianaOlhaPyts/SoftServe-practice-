@{
    ViewData["Title"] = "Оплата квитків";
    var totalPrice = ViewData["TotalPrice"];
    var ticketIds = ViewData["TicketIds"];
}

<h2>Оплата квитків</h2>

<p>Сума до оплати: <strong>@totalPrice$</strong></p>

<button id="pay-now-btn">Оплатити</button>

<script>
    document.getElementById("pay-now-btn").addEventListener("click", async () => {
        const response = await fetch('/Tickets/ProcessPayment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                ticketIds: "@ticketIds".split(','),
                amount: @totalPrice
            })
        });

        if (response.ok) {
            alert("Оплата успішна! Ваші місця тепер заброньовані.");
            window.location.href = "/Tickets/ClientManageTickets";
        } else {
            alert("Помилка оплати.");
        }
    });

        document.getElementById("paymentForm").addEventListener("submit", async (event) => {
        event.preventDefault();

        const ticketIds = Array.from(document.querySelectorAll(".seat.selected"))
                              .map(seat => seat.getAttribute("data-ticket-id"));

        if (ticketIds.length === 0) {
            alert("No tickets selected for payment.");
            return;
        }

        const response = await fetch('/Tickets/ProcessPayment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ TicketIds: ticketIds, Amount: parseFloat(@totalPrice) })
        });

        const result = await response.json();
        if (result.success) {
            alert("Payment successful!");
            location.reload();
        } else {
            alert("Payment failed.");
        }
    });

</script>
